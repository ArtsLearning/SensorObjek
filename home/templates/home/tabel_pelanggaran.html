{% extends "base_dashboard.html" %}
{% load static %}

{% block content %}

<div class="flex justify-between items-center mb-8">
    <h1 class="text-2xl font-bold text-blue-700 flex items-center gap-3">
        <i class="fa fa-table"></i> Tabel Pelanggaran
    </h1>
</div>

<div class="bg-white p-6 shadow rounded-2xl">

    <table class="w-full text-left">
        <thead>
            <tr class="border-b font-semibold text-gray-700">
                <th class="p-3">ID</th>
                <th class="p-3">Bukti Foto</th>
                <th class="p-3">Tanggal</th>
                <th class="p-3">Aksi</th>
            </tr>
        </thead>

        <tbody>
            {% for item in data %}
            <tr class="border-b hover:bg-gray-100">

                <td class="p-3">{{ forloop.counter }}</td>

                <td class="p-3">
                    <img src="{{ item.bukti_foto.url }}"
                         class="w-20 h-14 object-cover rounded-md shadow border cursor-pointer"
                         onclick="openDetail('{{ item.id }}','{{ item.bukti_foto.url }}','{{ item.tanggal }}','{{ item.waktu }}','{{ item.lokasi }}')">
                </td>

                <td class="p-3">{{ item.tanggal }}</td>

                <td class="p-3 flex gap-4">

                    <!-- DELETE WITH CONFIRM -->
                    <i class="fa fa-trash text-red-500 text-xl cursor-pointer"
                       onclick="confirmDelete('{{ item.id }}')"></i>

                    <!-- OPEN DETAIL CARD -->
                    <i class="fa fa-download text-blue-600 text-xl cursor-pointer"
                       onclick="openDetail('{{ item.id }}','{{ item.bukti_foto.url }}','{{ item.tanggal }}','{{ item.waktu }}','{{ item.lokasi }}')"></i>
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<!-- =========================
       MODAL DETAIL
========================= -->
<div id="detailCard" class="hidden fixed inset-0 bg-black/50 flex justify-center items-center z-50">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-[450px]">

        <div class="flex justify-between mb-3">
            <h2 class="text-xl font-bold">Detail Pelanggaran</h2>
            <i class="fa fa-times text-xl cursor-pointer" onclick="closeDetail()"></i>
        </div>

        <img id="detailImg" class="rounded-xl w-full h-60 object-cover shadow mb-4">

        <p><strong>ID:</strong> <span id="detailId"></span></p>
        <p><strong>Waktu:</strong> <span id="detailTime"></span></p>
        <p><strong>Lokasi:</strong> <span id="detailLocation"></span></p>

        <button id="exportBtn"
            class="w-full bg-blue-600 text-white mt-5 py-2 rounded-xl hover:bg-blue-700">
            Export PDF
        </button>

    </div>
</div>


<!-- =========================
       MODAL DELETE CONFIRM
========================= -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black/60 flex justify-center items-center z-50">
    <div class="bg-white p-5 rounded-xl shadow-lg w-[350px] text-center">
        <h2 class="text-xl font-bold mb-4">Hapus Data?</h2>
        <p class="mb-4">Apakah Anda yakin ingin menghapus data ini?</p>

        <div class="flex justify-center gap-4">
            <button onclick="closeDelete()" class="px-4 py-2 bg-gray-300 rounded-lg">Batal</button>
            <a id="deleteYes" class="px-4 py-2 bg-red-600 text-white rounded-lg">Hapus</a>
        </div>
    </div>
</div>


<script>
// ▪▪▪ DETAIL MODAL ▪▪▪
function openDetail(id, img, tanggal, waktu, lokasi) {
    document.getElementById("detailId").innerText = id;
    document.getElementById("detailImg").src = img;
    document.getElementById("detailTime").innerText = tanggal + " • " + waktu;
    document.getElementById("detailLocation").innerText = lokasi;

    document.getElementById("exportBtn").onclick = function () {
        window.location.href = "/export/" + id + "/";
    };

    document.getElementById("detailCard").classList.remove("hidden");
}

function closeDetail() {
    document.getElementById("detailCard").classList.add("hidden");
}


// ▪▪▪ DELETE CONFIRM MODAL ▪▪▪
function confirmDelete(id) {
    document.getElementById("deleteYes").href = "/delete/" + id + "/";
    document.getElementById("deleteModal").classList.remove("hidden");
}

function closeDelete() {
    document.getElementById("deleteModal").classList.add("hidden");
}
</script>

{% endblock %}
