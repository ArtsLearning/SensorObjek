{% extends "base_dashboard.html" %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="space-y-10">

    <!-- =============================== -->
    <!-- TOP SEARCH + PROFILE -->
    <!-- =============================== -->
    <div class="flex justify-between items-center">
        <input type="text"
               placeholder="Cari data..."
               class="px-4 py-2 w-80 rounded-xl border border-gray-300 shadow-sm focus:ring-2 focus:ring-blue-500" />

        <div class="flex items-center gap-4">
            <i class="fa fa-bell text-2xl text-gray-600"></i>
            <img src="https://randomuser.me/api/portraits/men/32.jpg"
                 class="w-12 h-12 rounded-full border-2 border-blue-500"/>
        </div>
    </div>

    <!-- =============================== -->
    <!-- TOP STAT CARDS -->
    <!-- =============================== -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">

        <!-- Motor -->
        <div class="bg-white shadow rounded-xl p-6 flex items-center gap-4">
            <i class="fa fa-motorcycle text-3xl text-blue-700"></i>
            <div>
                <h2 id="motor-count" class="text-xl font-bold">0</h2>
                <p class="text-gray-500">Motor Hari Ini</p>
            </div>
        </div>

        <!-- Mobil -->
        <div class="bg-white shadow rounded-xl p-6 flex items-center gap-4">
            <i class="fa fa-car text-3xl text-blue-700"></i>
            <div>
                <h2 id="mobil-count" class="text-xl font-bold">0</h2>
                <p class="text-gray-500">Mobil Hari Ini</p>
            </div>
        </div>

        <!-- Pelanggar -->
        <div class="bg-white shadow rounded-xl p-6 flex items-center gap-4">
            <i class="fa fa-user-times text-3xl text-red-600"></i>
            <div>
                <h2 id="pelanggar-count" class="text-xl font-bold">0</h2>
                <p class="text-gray-500">Pelanggar Hari Ini</p>
            </div>
        </div>

        <!-- Total Kendaraan -->
        <div class="bg-white shadow rounded-xl p-6 flex items-center gap-4">
            <i class="fa fa-road text-3xl text-green-600"></i>
            <div>
                <h2 id="total-count" class="text-xl font-bold">0</h2>
                <p class="text-gray-500">Total Kendaraan</p>
            </div>
        </div>

    </div>

    <!-- =============================== -->
    <!-- CHARTS -->
    <!-- =============================== -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- Donut Chart -->
        <div class="bg-white shadow rounded-xl p-6">
            <h3 class="font-semibold mb-4 text-gray-700">Rasio Kendaraan</h3>
            <canvas id="donutChart"></canvas>
        </div>

        <!-- Line Chart -->
        <div class="md:col-span-2 bg-white shadow rounded-xl p-6">
            <h3 class="font-semibold mb-4 text-gray-700">Trend Total Kendaraan Per Bulan</h3>
            <canvas id="lineChart"></canvas>
        </div>

    </div>

    <!-- =============================== -->
    <!-- DATA TABLE -->
    <!-- =============================== -->
    <div class="bg-white shadow rounded-xl p-6">
        <h2 class="text-xl font-bold mb-4">Data Pelanggaran Terbaru</h2>

        <table class="w-full text-left">
            <thead class="border-b bg-gray-50">
                <tr>
                    <th class="p-3">ID</th>
                    <th class="p-3">Nomor Plat</th>
                    <th class="p-3">Tanggal</th>
                    <th class="p-3">Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for n in "12345"|make_list %}
                <tr class="border-b hover:bg-gray-100 transition">
                    <td class="p-3 font-semibold">#00{{ forloop.counter }}</td>
                    <td class="p-3">BP 1234 AC</td>
                    <td class="p-3">27-10-2025</td>
                    <td class="p-3 flex gap-4">
                        <i class="fa fa-eye text-blue-600 cursor-pointer"></i>
                        <i class="fa fa-pen text-yellow-600 cursor-pointer"></i>
                        <i class="fa fa-trash text-red-600 cursor-pointer"></i>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>

</div>

<!-- =============================== -->
<!-- CHART JS SCRIPT -->
<!-- =============================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ======================= */
/* DONUT CHART */
/* ======================= */
const donutCtx = document.getElementById("donutChart");
window.donutChart = new Chart(donutCtx, {
    type: "doughnut",
    data: {
        labels: ["Motor", "Mobil", "Pelanggar"],
        datasets: [{
            data: [0, 0, 0],
            backgroundColor: ["#2563eb", "#38bdf8", "#ef4444"],
            borderWidth: 0
        }]
    },
    options: {
        cutout: "65%",
        plugins: { legend: { position: "bottom" } }
    }
});

/* ======================= */
/* LINE CHART */
/* ======================= */
const lineCtx = document.getElementById("lineChart");
window.lineChart = new Chart(lineCtx, {
    type: "line",
    data: {
        labels: ["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu"],
        datasets: [{
            label: "Total Kendaraan",
            data: [5000, 6400, 5800, 7200, 6900, 7500, 8000, 8600],
            borderColor: "#2563eb",
            backgroundColor: "#2563eb40",
            tension: 0.3,
            fill: true
        }]
    },
    options: {
        plugins: { legend: { position: "bottom" }},
        scales: {
            y: { beginAtZero: true }
        }
    }
});

/* ======================= */
/* UPDATE CHART REALTIME */
/* ======================= */
function updateCharts(data) {
    // Update Donut Chart
    if (window.donutChart) {
        window.donutChart.data.datasets[0].data = [
            data.motor,
            data.mobil,
            data.pelanggar
        ];
        window.donutChart.update();
    }

    // Update nilai di atas kartu (Total tanpa pelanggar)
    const total = data.motor + data.mobil;
    updateText("total-count", total);
}
</script>

<!-- =============================== -->
<!-- GLOBAL REALTIME JS -->
<!-- =============================== -->
<script src="{% static 'js/realtime.js' %}"></script>

{% endblock %}
